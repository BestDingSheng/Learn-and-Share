## 攻击及预防

目前web的安全问题主要有下面几个：

* XSS漏洞
* CSRF漏洞

### XSS

跨站脚本攻击通过构造特殊的数据，在用户浏览器上执行特定的脚本，来盗用用户的身份。这些有危害的脚本主要是靠插入到Web页面而实现的，可以利用用户的点击来获取cookie中的私密信息，或者在某些地方添加一个恶意的表单，当用户提交表单的时候，将信息发送到攻击者的服务器中，等等。

通过将脚本注入到页面中，诱骗其他用户来访问这些页面，就可以获取用户的cookie信息，将cookie复制到自己的浏览器中，就可以模拟其他用户的请求了。这种攻击方法是被动的，需要被攻击者主动去访问伪造的页面，并且主动进行脚本触发工作。

#### 防范方法

首先需要对用户的输入进行过滤，不能够相信任何用户的输入，尤其是和HTML相关的字符，比如尖括号、引号等字符进行过滤。并且对于任何内容都要进行`encode`操作。*针对存储型XSS*

其次是保护好用户的`cookie`，`cookie`应该只保存用户的登录状态，如果必须要保存密码的话，那么建议加盐等方法对于密码进行二次加密。或者如果不希望客户端再次去操作`cookie`，而是只将`cookie`作为一个保存用户登录状态的工具的话，那么对于`Set-Cookie`首部添加`HttpOnly`来保证cookie不能够被JavaScript操作，这样就保证了cookie的安全。*针对反射型XSS*

最后是尽量使用POST方法进行表单的提交，不要使用GET。

### CSRF

跨站请求伪造，攻击者会伪造一个页面，这个页面中的某个部分可能含有用于攻击的代码，这些代码会*借用（注意这里的借用，这是CSRF和XSS的最主要的区别）*被攻击者的客户端来进行攻击。这些攻击可能包含各种操作，比如伪造Form表单的提交，伪造添加用户的操作等等，这些操作由于借用的被攻击者的客户端，所以盗用了客户端的身份，完全规避了同源策略的限制。

CSRF基于HTTP较为宽松的身份验证机制，也就是基于以`cookie`为基础的session机制，这种机制无法保证该操作确实为指定用户进行的。

#### 防范机制

对于CSRF来说，最主要的是利用客户端直接对服务端的数据进行合法操作，如果对于容易被插入的GET方法，严格地只允许其读取服务器上的数据，可以保证除了POST请求之外的漏洞。

对于POST请求，当用户需要进行POST操作的时候，站点会生成一个伪随机值，并且将其放在cookie中，每当进行POST操作，都需要将这个伪随机值发送到服务器，才能够进行相应的操作。也可以使用图片验证码作为这个伪随机数。

使用HTTP的referer首部字段，来标志HTTP请求的来源。服务器通过对请求来源进行验证，保证请求来自于自己的网站。但是referer也有被篡改的风险，并且如果用户不允许记录referer的话，那么正常的请求会被当做CSRF，从而被拒绝。

### 两者的区别

作为web攻击的两个主要的手段，看起来似乎有一些类似，但是还是有很大的不同。

首先XSS着重于获取用户客户端的信息，比如`cookie`这样的信息，如果获取了这样的信息之后，就可以将自己伪造成那个客户端了。

XSS利用浏览器可以对JavaScript直接执行的操作，来诱骗浏览器进行脚本操作。XSS的漏洞会让CSRF的防御措施完全崩溃。XSS又分为反射型XSS和存储型XSS，其中，反射型XSS是欺骗用户点击来进行盗取，而存储型是通过将代码存储到服务器中，在该页面被访问的时候进行触发。

而CSRF着重于让用户客户端自己进行一些非法操作，是借用客户端的信息，比如`cookie`。来让客户端自己发起危险的请求。

CSRF利用URL的拼接，来诱骗用户直接提交构造好的请求。并不执行脚本。